
if not getgenv then getgenv = function() return _G end end
local env = getgenv()

if not env.DragonFarmConfig then
    warn("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö Config! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô...")
    env.DragonFarmConfig = {
        SELL_THRESHOLD = 10000,
        MOVEMENT_SPEED = 1.5,
        ATTACK_DELAY = 0.03,
        
        FPS_BOOST_ENABLED = true,
        TARGET_FPS = 60,
        
        SHOW_FRUIT_GUI = true,
        SHOW_COIN_GUI = true,
        GUI_UPDATE_RATE = 0.5
    }
end

local CONFIG = env.DragonFarmConfig

--// üì¶ SERVICES & VARIABLES
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

--// ‚úÖ ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Infinite yield (‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏≤ folder ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á)
local Interactions = workspace:FindFirstChild("Interactions")
local Nodes = Interactions and Interactions:FindFirstChild("Nodes")
local FoodFolder = nil

if Nodes then
    FoodFolder = Nodes:FindFirstChild("Food") 
        or Nodes:FindFirstChild("LargeFoodNode") 
        or Nodes:FindFirstChild("Foods") 
        or Nodes:FindFirstChildWhichIsA("Folder")
end

if not FoodFolder then
    warn("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå Food ‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏ô‡∏µ‡πâ ‚Üí ‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ü‡∏≤‡∏£‡πå‡∏°")
end


local CollectableNames = { "EdamameFoodModel", "KajiFruitFoodModel", "MistSudachiFoodModel" }

local FARM_WORLD = 125804922932357
local SELL_WORLD = 3475397644
local RANDOM_WORLDS = {
    4601778915, 3475419198, 3475422608, 3487210751,
    3623549100, 3737848045, 3752680052, 4174118306, 4728805070
}

local PATROL_POSITIONS = {
    Vector3.new(-266, 467, -394),
    Vector3.new(1757, 783, 672),
    Vector3.new(1420, 319, -1409),
    Vector3.new(1922, 620, -2566),
    Vector3.new(2226, 585, -4128),
    Vector3.new(330, 901, -4304),
    Vector3.new(-1433, 779, -4717),
    Vector3.new(-3031, 780, -4211),
    Vector3.new(-2643, 547, -2250),
    Vector3.new(-857, 401, -2132),
    Vector3.new(-828, 688, -3444),
    Vector3.new(-1819, 405, 170),
    Vector3.new(-1523, 962, 1150)
}

--// üöÄ FPS BOOSTER
local function boostFPS()
    if not CONFIG.FPS_BOOST_ENABLED then return end
    
    print("üöÄ ‡πÄ‡∏õ‡∏¥‡∏î FPS Booster...")
    
    local lighting = game:GetService("Lighting")
    local terrain = workspace:FindFirstChildOfClass("Terrain")
    
    settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
    
    for _, v in pairs(lighting:GetChildren()) do
        if v:IsA("PostEffect") or v:IsA("BloomEffect") or v:IsA("BlurEffect") 
            or v:IsA("ColorCorrectionEffect") or v:IsA("SunRaysEffect") then
            v.Enabled = false
        end
    end
    
    if terrain then
        terrain.WaterWaveSize = 0
        terrain.WaterWaveSpeed = 0
        terrain.WaterReflectance = 0
        terrain.WaterTransparency = 0
    end
    
    task.spawn(function()
        while CONFIG.FPS_BOOST_ENABLED do
            for _, obj in pairs(workspace:GetDescendants()) do
                if obj:IsA("ParticleEmitter") or obj:IsA("Trail") or obj:IsA("Smoke") 
                    or obj:IsA("Fire") or obj:IsA("Sparkles") then
                    pcall(function() obj.Enabled = false end)
                end
            end
            task.wait(5)
        end
    end)
    
    if setfpscap then
        setfpscap(CONFIG.TARGET_FPS)
    end
    
    print("‚úÖ FPS Booster ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Target: " .. CONFIG.TARGET_FPS .. " FPS)")
end

--// üõ°Ô∏è REMOVE MOB DAMAGE
local function removeMobDamageRemote()
    local RS = game:GetService("ReplicatedStorage")
    local RemotesFolder = RS:WaitForChild("Remotes")

    local function killAllOnce()
        local removed = 0
        for _, obj in ipairs(RemotesFolder:GetDescendants()) do
            if obj.Name == "MobDamageRemote" then
                pcall(function() obj:Destroy() end)
                removed += 1
            end
        end
        return removed
    end

    task.spawn(function()
        for i = 1, 15 do
            local count = killAllOnce()
            if count > 0 then
                print(("üóëÔ∏è ‡∏•‡∏ö MobDamageRemote x%d"):format(count))
            end
            task.wait(1)
        end

        RemotesFolder.DescendantAdded:Connect(function(obj)
            if obj.Name == "MobDamageRemote" then
                task.defer(function()
                    pcall(function() obj:Destroy() end)
                end)
            end
        end)
    end)
end

--// üêâ DRAGON FUNCTIONS
local function getAnyDragonRemote()
    local dragonsFolder = character:WaitForChild("Dragons")
    for _, dragon in pairs(dragonsFolder:GetChildren()) do
        local remotes = dragon:FindFirstChild("Remotes")
        if remotes and remotes:FindFirstChild("PlaySoundRemote") then
            return remotes.PlaySoundRemote
        end
    end
    return nil
end

local function spamAttack(targetPart)
    local remote = getAnyDragonRemote()
    if not remote then return false end
    
    local health = targetPart:FindFirstChild("Health")
    if not health then return false end

    while health and health.Value > 0 and targetPart.Parent do
        local args = {"Breath", "Destructibles", targetPart}
        remote:FireServer(unpack(args))
        task.wait(CONFIG.ATTACK_DELAY)
    end
    return true
end

--// üçé FOOD NODE FUNCTIONS
local function getAllAliveNodes()
    local aliveNodes = {}
    for _, subFolder in pairs(FoodFolder:GetChildren()) do
        for _, node in pairs(subFolder:GetDescendants()) do
            if node.Name == "BillboardPart" and node:FindFirstChild("Health") and node.Health.Value > 0 then
                table.insert(aliveNodes, node)
            end
        end
    end
    return aliveNodes
end

local function getClosestAliveNode()
    local nodeList = getAllAliveNodes()
    local closestNode, closestDist = nil, math.huge
    for _, node in pairs(nodeList) do
        local dist = (hrp.Position - node.Position).Magnitude
        if dist < closestDist then
            closestNode = node
            closestDist = dist
        end
    end
    return closestNode
end

local function collectNearbyFoods()
    for _, obj in pairs(workspace.Camera:GetChildren()) do
        for _, name in ipairs(CollectableNames) do
            if obj.Name == name then
                for _, part in pairs(obj:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CFrame = hrp.CFrame
                    end
                end
            end
        end
    end
end

--// üöú AUTO FARM
local function startAutoFarm()
    task.spawn(function()
        while task.wait(1) do
            local node = getClosestAliveNode()
            if node then
                hrp.CFrame = node.CFrame + Vector3.new(0, 4, 0)
                spamAttack(node)
            else
                for _, pos in ipairs(PATROL_POSITIONS) do
                    hrp.CFrame = CFrame.new(pos)
                    task.wait(CONFIG.MOVEMENT_SPEED)
                    if getClosestAliveNode() then break end
                end
            end
        end
    end)
end

local function startAutoCollect()
    task.spawn(function()
        while task.wait(1) do
            collectNearbyFoods()
        end
    end)
end

--// üí∞ SELL FUNCTIONS
local function sellAllItems()
    local resources = player:WaitForChild("Data"):WaitForChild("Resources")
    for _, item in ipairs({"Edamame", "KajiFruit", "MistSudachi"}) do
        local val = resources:FindFirstChild(item)
        if val and val.Value > 0 then
            local args = {{ ItemName = item, Amount = val.Value }}
            ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("SellItemRemote"):FireServer(unpack(args))
            print("üí∞ ‡∏Ç‡∏≤‡∏¢:", item, "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô", val.Value)
        end
    end
end

local function startCheckInventory()
    task.spawn(function()
        while task.wait(1) do
            local resources = player:WaitForChild("Data"):WaitForChild("Resources")
            local eda  = resources:FindFirstChild("Edamame") and resources.Edamame.Value or 0
            local kaji = resources:FindFirstChild("KajiFruit") and resources.KajiFruit.Value or 0
            local mist = resources:FindFirstChild("MistSudachi") and resources.MistSudachi.Value or 0

            if eda >= CONFIG.SELL_THRESHOLD 
                or kaji >= CONFIG.SELL_THRESHOLD 
                or mist >= CONFIG.SELL_THRESHOLD then
                print("üì¶ ‡∏°‡∏µ‡∏Ç‡∏≠‡∏á‡∏ñ‡∏∂‡∏á " .. CONFIG.SELL_THRESHOLD .. " ‚Üí ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÑ‡∏õ‡∏Ç‡∏≤‡∏¢...")
                task.wait(5)
                ReplicatedStorage.Remotes.WorldTeleportRemote:InvokeServer(SELL_WORLD, {})
                break
            end
        end
    end)
end

--// üëÅÔ∏è PLAYER MONITOR (‡∏ï‡∏£‡∏ß‡∏à‡∏ó‡∏∏‡∏Å 1 ‡∏ß‡∏¥ ‡πÅ‡∏ö‡∏ö‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥)
local function monitorPlayers()
    task.spawn(function()
        while true do
            task.wait(1) -- ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏ó‡∏∏‡∏Å 1 ‡∏ß‡∏¥

            local currentPlace = game.PlaceId
            local playerCount = #Players:GetPlayers()

            -- üßç‚Äç‚ôÇÔ∏è ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏∑‡πà‡∏ô
            if playerCount > 1 then
                warn("‚ö†Ô∏è ‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå ‚Üí ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏∏‡πà‡∏°‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÉ‡∏ô 3 ‡∏ß‡∏¥...")
                task.wait(3)

                local randomWorld = RANDOM_WORLDS[math.random(1, #RANDOM_WORLDS)]
                pcall(function()
                    ReplicatedStorage.Remotes.WorldTeleportRemote:InvokeServer(randomWorld, {})
                end)

                print("üåç ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÑ‡∏õ‡πÇ‡∏•‡∏Å‡∏™‡∏∏‡πà‡∏°:", randomWorld)
                task.wait(10) -- ‚è≥ ‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏•‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡πÉ‡∏´‡∏°‡πà
            end

            -- üåè ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏•‡∏Å‡πÑ‡∏´‡∏ô
            if currentPlace ~= FARM_WORLD and currentPlace ~= SELL_WORLD then
                warn("üö´ ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡πÇ‡∏•‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏≤‡∏¢ (PlaceId:", currentPlace, ") ‚Üí ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡∏Å‡∏•‡∏±‡∏ö‡πÇ‡∏•‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏°")
                pcall(function()
                    ReplicatedStorage.Remotes.WorldTeleportRemote:InvokeServer(FARM_WORLD, {})
                end)

                task.wait(4) -- ‚è≥ ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡πÉ‡∏´‡∏°‡πà
            else
                -- ‚úÖ ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏ï‡∏£‡∏ß‡∏à‡∏ã‡πâ‡∏≥‡∏ó‡∏∏‡∏Å 1 ‡∏ß‡∏¥
                print("üü¢ ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á:", currentPlace)
            end
        end
    end)
end



--// üé® GUI SYSTEM
local function createGUI()
    if game.CoreGui:FindFirstChild("FarmGUI") then
        game.CoreGui.FarmGUI:Destroy()
    end

    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "FarmGUI"
    screenGui.ResetOnSpawn = false
    screenGui.IgnoreGuiInset = true
    screenGui.Parent = game.CoreGui

    -- üí∞ Coin Display
    if CONFIG.SHOW_COIN_GUI then
        local coinLabel = Instance.new("TextLabel")
        coinLabel.Name = "CoinLabel"
        coinLabel.Size = UDim2.new(0, 250, 0, 60)
        coinLabel.Position = UDim2.new(0.5, -125, 0.05, 0)
        coinLabel.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
        coinLabel.BackgroundTransparency = 0.3
        coinLabel.BorderSizePixel = 0
        coinLabel.TextColor3 = Color3.fromRGB(255, 223, 0)
        coinLabel.TextStrokeTransparency = 0.5
        coinLabel.TextScaled = true
        coinLabel.Font = Enum.Font.GothamBold
        coinLabel.Text = "üí∞ Loading..."
        coinLabel.Parent = screenGui

        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 12)
        corner.Parent = coinLabel

        task.spawn(function()
            local coinsValue = player:WaitForChild("Data"):WaitForChild("Currency"):WaitForChild("Coins")
            local lastCoins = coinsValue.Value
            
            while task.wait(CONFIG.GUI_UPDATE_RATE) do
                local current = coinsValue.Value
                local diff = current - lastCoins

                if diff > 0 then
                    coinLabel.TextColor3 = Color3.fromRGB(0, 255, 127)
                elseif diff < 0 then
                    coinLabel.TextColor3 = Color3.fromRGB(255, 80, 80)
                else
                    coinLabel.TextColor3 = Color3.fromRGB(255, 223, 0)
                end

                coinLabel.Text = string.format("üí∞ %s", tostring(current))
                lastCoins = current
            end
        end)
    end

    -- üçé Fruit Display
    if CONFIG.SHOW_FRUIT_GUI then
        local fruitFrame = Instance.new("Frame")
        fruitFrame.Name = "FruitFrame"
        fruitFrame.Size = UDim2.new(0, 280, 0, 150)
        fruitFrame.Position = UDim2.new(0.5, -140, 0.15, 0)
        fruitFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
        fruitFrame.BackgroundTransparency = 0.3
        fruitFrame.BorderSizePixel = 0
        fruitFrame.Parent = screenGui

        local frameCorner = Instance.new("UICorner")
        frameCorner.CornerRadius = UDim.new(0, 12)
        frameCorner.Parent = fruitFrame

        local fruits = {
            {name = "Edamame", icon = "ü´ò", color = Color3.fromRGB(144, 238, 144)},
            {name = "KajiFruit", icon = "üçä", color = Color3.fromRGB(255, 165, 0)},
            {name = "MistSudachi", icon = "üçã", color = Color3.fromRGB(255, 255, 102)}
        }

        for i, fruit in ipairs(fruits) do
            local label = Instance.new("TextLabel")
            label.Name = fruit.name .. "Label"
            label.Size = UDim2.new(1, -20, 0, 40)
            label.Position = UDim2.new(0, 10, 0, (i-1) * 45 + 10)
            label.BackgroundTransparency = 1
            label.TextColor3 = fruit.color
            label.TextStrokeTransparency = 0.5
            label.TextScaled = true
            label.Font = Enum.Font.GothamBold
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.Text = fruit.icon .. " Loading..."
            label.Parent = fruitFrame
        end

        task.spawn(function()
            local resources = player:WaitForChild("Data"):WaitForChild("Resources")
            while task.wait(CONFIG.GUI_UPDATE_RATE) do
                for i, fruit in ipairs(fruits) do
                    local val = resources:FindFirstChild(fruit.name)
                    if val then
                        local label = fruitFrame:FindFirstChild(fruit.name .. "Label")
                        if label then
                            label.Text = string.format("%s %s: %d", fruit.icon, fruit.name, val.Value)
                        end
                    end
                end
            end
        end)
    end
end

--// üîÑ ANTI-AFK
local function startAntiAFK()
    task.spawn(function()
        local VIM = game:GetService("VirtualInputManager")
        while true do
            task.wait(180)
            VIM:SendKeyEvent(true, Enum.KeyCode.A, false, game)
            task.wait(0.1)
            VIM:SendKeyEvent(false, Enum.KeyCode.A, false, game)
        end
    end)
end



boostFPS()
createGUI()
startAntiAFK()

local placeId = game.PlaceId

if placeId == FARM_WORLD then
    print("üöú ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏° ‚Üí ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥")
    startAutoFarm()
    startAutoCollect()
    startCheckInventory()
    monitorPlayers()
    task.wait(5)
    removeMobDamageRemote()

elseif placeId == SELL_WORLD then
    print("üí∞ ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏Ç‡∏≤‡∏¢ ‚Üí ‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ü‡∏≤‡∏£‡πå‡∏°")
    task.wait(2)
    sellAllItems()
    task.wait(3)
    ReplicatedStorage.Remotes.WorldTeleportRemote:InvokeServer(FARM_WORLD, {})

else
    print("üåç ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡πÇ‡∏•‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏°/‡∏Ç‡∏≤‡∏¢ ‚Üí ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡∏Å‡∏•‡∏±‡∏ö‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô")
    pcall(function()
        ReplicatedStorage.Remotes.WorldTeleportRemote:InvokeServer(FARM_WORLD, {})
    end)
    
    -- ‡∏´‡∏¢‡∏∏‡∏î‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ô‡∏ï‡πà‡∏≠
    return
end
